# Deno NDL API Library - é–‹ç™ºãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

å›½ç«‹å›½ä¼šå›³æ›¸é¤¨ï¼ˆNDLï¼‰APIã®å‹å®‰å…¨ãªDenoãƒ©ã‚¤ãƒ–ãƒ©ãƒªé–‹ç™ºãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã€‚ Zod
v4ã«ã‚ˆã‚‹å³å¯†ãªå‹å®šç¾©ã¨ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆé–‹ç™ºã‚’æ¡ç”¨ã€‚

## é–‹ç™ºæ–¹é‡

### ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£åŸå‰‡

- **å‹å®‰å…¨æ€§æœ€å„ªå…ˆ**: Zod v4ã«ã‚ˆã‚‹ãƒ©ãƒ³ã‚¿ã‚¤ãƒ æ¤œè¨¼ã¨TypeScriptå‹ã®å®Œå…¨ãªä¸€è‡´
- **ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆé–‹ç™º**: å®Ÿè£…å‰ã«ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã‚’å®šç¾©
- **ãƒ¢ã‚¸ãƒ¥ãƒ©ãƒ¼è¨­è¨ˆ**: å„APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¯ç‹¬ç«‹ã—ã¦ä½¿ç”¨å¯èƒ½
- **ã‚¨ãƒ©ãƒ¼å‡¦ç†ã®ä¸€è²«æ€§**: äºˆæ¸¬å¯èƒ½ãªã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

### æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

- **ãƒ©ãƒ³ã‚¿ã‚¤ãƒ **: Deno 2.0+
- **å‹ã‚·ã‚¹ãƒ†ãƒ **: TypeScript 5.0+ with strict mode
- **ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³**: Zod v3.25+ (`npm:zod`) - **v4ã‚’ä½¿ç”¨**
- **XMLãƒ‘ãƒ¼ã‚¹**: fast-xml-parser v5.2+ (`npm:fast-xml-parser`)
- **ãƒ†ã‚¹ãƒˆ**: Denoæ¨™æº–ãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ (`@std/assert`)
- **HTTPã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ**: Fetch API (Webæ¨™æº–)

### ãƒ©ã‚¤ãƒ–ãƒ©ãƒªimportè¦ç´„

```typescript
// Zod v4 (å¿…é ˆ) - v3ã®importã¯ç¦æ­¢
import { z } from "zod/v4"; // âœ… æ­£ã—ã„
// import { z } from "zod";  // âŒ v3ãªã®ã§ç¦æ­¢

// XML Parser
import { XMLParser } from "fast-xml-parser";

// Error handling
import type { Result } from "neverthrow";
import { err, ok } from "neverthrow";

// ãƒ†ã‚¹ãƒˆ
import { assert, assertEquals } from "@std/assert";
```

## NDL APIå®Ÿè£…çŠ¶æ³

### âœ… å®Ÿè£…æ¸ˆã¿

#### 1. æ¤œç´¢API
- **SRU** (Search/Retrieve via URL) - å®Œå…¨å®Ÿè£…
- **OpenSearch** - å®Œå…¨å®Ÿè£…

### ğŸš§ ä»Šå¾Œå®Ÿè£…äºˆå®š

#### 1. æ¤œç´¢API
- **OpenURL** - æœªå®Ÿè£…

#### 2. ãƒãƒ¼ãƒ™ã‚¹ãƒˆAPI
- **OAI-PMH** (ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ãƒãƒ¼ãƒ™ã‚¹ãƒ†ã‚£ãƒ³ã‚°) - æœªå®Ÿè£…

#### 3. ã‚µãƒ ãƒã‚¤ãƒ«API
- æ›¸å½±ç”»åƒã®å–å¾— - æœªå®Ÿè£…

## ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

```
deno-ndl/
â”œâ”€â”€ mod.ts                  # ãƒ¡ã‚¤ãƒ³ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
â”œâ”€â”€ cli.ts                  # CLIã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆï¼ˆTODOï¼‰
â”œâ”€â”€ deno.jsonc              # Denoè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«
â”œâ”€â”€ deno.lock               # ä¾å­˜é–¢ä¿‚ãƒ­ãƒƒã‚¯ãƒ•ã‚¡ã‚¤ãƒ«
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ api/               # APIé–¢æ•°å®Ÿè£…
â”‚   â”‚   â”œâ”€â”€ sru.ts         # âœ… SRU APIå®Ÿè£…
â”‚   â”‚   â””â”€â”€ opensearch.ts  # âœ… OpenSearch APIå®Ÿè£…
â”‚   â”œâ”€â”€ schemas/           # Zodã‚¹ã‚­ãƒ¼ãƒå®šç¾©
â”‚   â”‚   â”œâ”€â”€ common.ts      # âœ… å…±é€šã‚¹ã‚­ãƒ¼ãƒ
â”‚   â”‚   â”œâ”€â”€ error.ts       # âœ… ã‚¨ãƒ©ãƒ¼ã‚¹ã‚­ãƒ¼ãƒ
â”‚   â”‚   â”œâ”€â”€ utils.ts       # âœ… ã‚¹ã‚­ãƒ¼ãƒãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”‚   â”‚   â”œâ”€â”€ sru/           # âœ… SRUé–¢é€£ã‚¹ã‚­ãƒ¼ãƒ
â”‚   â”‚   â”œâ”€â”€ opensearch/    # âœ… OpenSearché–¢é€£ã‚¹ã‚­ãƒ¼ãƒ
â”‚   â”‚   â”œâ”€â”€ openurl/       # ğŸš§ OpenURLé–¢é€£ï¼ˆæœªå®Ÿè£…ï¼‰
â”‚   â”‚   â”œâ”€â”€ oai_pmh/       # ğŸš§ OAI-PMHé–¢é€£ï¼ˆæœªå®Ÿè£…ï¼‰
â”‚   â”‚   â””â”€â”€ thumbnail/     # ğŸš§ Thumbnailé–¢é€£ï¼ˆæœªå®Ÿè£…ï¼‰
â”‚   â”œâ”€â”€ errors.ts          # âœ… ã‚¨ãƒ©ãƒ¼å‹å®šç¾©
â”‚   â”œâ”€â”€ utils/             # âœ… ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°
â”‚   â”‚   â”œâ”€â”€ cql-builder.ts # âœ… CQLã‚¯ã‚¨ãƒªãƒ“ãƒ«ãƒ€ãƒ¼
â”‚   â”‚   â””â”€â”€ http.ts        # âœ… HTTPé–¢é€£ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”‚   â””â”€â”€ cli/               # ğŸš§ CLIã‚³ãƒãƒ³ãƒ‰å®Ÿè£…ï¼ˆæœªå®Ÿè£…ï¼‰
â”‚       â”œâ”€â”€ commands/
â”‚       â””â”€â”€ formatters/
â”œâ”€â”€ tests/                 # âœ… ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«
â”‚   â”œâ”€â”€ api/               # âœ… APIå˜ä½“ãƒ†ã‚¹ãƒˆ
â”‚   â”œâ”€â”€ schemas/           # âœ… ã‚¹ã‚­ãƒ¼ãƒãƒ†ã‚¹ãƒˆ
â”‚   â”œâ”€â”€ utils/             # âœ… ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆ
â”‚   â””â”€â”€ integration/       # âœ… çµ±åˆãƒ†ã‚¹ãƒˆ
â”œâ”€â”€ examples/              # âœ… ä½¿ç”¨ä¾‹
â”‚   â”œâ”€â”€ opensearch/        # âœ… OpenSearchä½¿ç”¨ä¾‹
â”‚   â””â”€â”€ sru/               # âœ… SRUä½¿ç”¨ä¾‹
â”œâ”€â”€ scripts/               # âœ… ãƒ†ã‚¹ãƒˆç”¨ãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£
â””â”€â”€ docs/                  # ğŸš§ è©³ç´°ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼ˆæœªå®Ÿè£…ï¼‰
```

## å®Ÿè£…ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

### ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„

1. **å‘½åè¦å‰‡**
   - APIé–¢æ•°: `${å‹•è©}${å¯¾è±¡}` (ä¾‹: `searchSRU`, `searchOpenSearch`)
   - ã‚¹ã‚­ãƒ¼ãƒ: `${åå‰}Schema` (ä¾‹: `SRUResponseSchema`, `OpenSearchResponseSchema`)
   - å‹å®šç¾©: ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ä»˜ãçµ±ä¸€å‘½å (ä¾‹: `SRUSearchItem`, `OpenSearchItem`, `SRUSearchResponse`, `OpenSearchSearchResponse`)
   - ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£: `${å‹•è©}${åå‰}` (ä¾‹: `parseXML`, `formatDate`)

2. **é–¢æ•°è¨­è¨ˆ**
   - ç´”ç²‹é–¢æ•°ã‚’å„ªå…ˆ
   - å‰¯ä½œç”¨ã¯æœ€å°é™ã«
   - é«˜éšé–¢æ•°ã¨ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å‡¦ç†ã‚’æ´»ç”¨
   - éƒ¨åˆ†é©ç”¨ã¨ã‚«ãƒªãƒ¼åŒ–ã‚’é©åˆ‡ã«ä½¿ç”¨

3. **ã‚¨ãƒ©ãƒ¼å‡¦ç†**
   - Resultå‹ãƒ‘ã‚¿ãƒ¼ãƒ³ã®æ¡ç”¨ (`Result<T, E>`)
   - ä¾‹å¤–ã¯å¢ƒç•Œã§ã®ã¿ã‚­ãƒ£ãƒƒãƒ
   - ã‚¨ãƒ©ãƒ¼ã¯å€¤ã¨ã—ã¦æ‰±ã†

4. **ãƒ†ã‚¹ãƒˆæˆ¦ç•¥**
   - ç´”ç²‹é–¢æ•°ã®å˜ä½“ãƒ†ã‚¹ãƒˆå„ªå…ˆ
   - ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãƒ™ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆæ´»ç”¨
   - çµ±åˆãƒ†ã‚¹ãƒˆã¯æœ€å°é™ã«

## é–‹ç™ºãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

### ãƒ–ãƒ©ãƒ³ãƒæˆ¦ç•¥

- **main**: ãƒªãƒªãƒ¼ã‚¹å¯èƒ½ãªçŠ¶æ…‹ã‚’ç¶­æŒï¼ˆç›´æ¥pushç¦æ­¢ï¼‰
- **feature/**: æ©Ÿèƒ½é–‹ç™ºç”¨ãƒ–ãƒ©ãƒ³ãƒ

### é–‹ç™ºã‚µã‚¤ã‚¯ãƒ«

1. **Issueä½œæˆ**: ã‚¿ã‚¹ã‚¯ã‚’Issueã¨ã—ã¦è¨˜éŒ²
2. **ãƒ–ãƒ©ãƒ³ãƒä½œæˆ**: `feature/#{issueç•ªå·}-æ©Ÿèƒ½å`
3. **å®Ÿè£…**: ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆã§é–‹ç™º
4. **PRä½œæˆ**: `Closes #issueç•ªå·`ã‚’å«ã‚ã‚‹
5. **ãƒãƒ¼ã‚¸**: ãƒ†ã‚¹ãƒˆé€šéå¾Œã«ãƒãƒ¼ã‚¸

### ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

```
<type>: <å†…å®¹> (#issueç•ªå·)
```

**Type**:

- `feat`: æ–°æ©Ÿèƒ½
- `fix`: ãƒã‚°ä¿®æ­£
- `docs`: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
- `test`: ãƒ†ã‚¹ãƒˆ
- `refactor`: ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°
- `chore`: ãã®ä»–

**ä¾‹**: `feat: SRUæ¤œç´¢APIã®å®Ÿè£… (#1)`

### GitHub Issuesãƒ»ãƒ©ãƒ™ãƒ«ç®¡ç†

#### æ¨™æº–ãƒ©ãƒ™ãƒ«

- `bug` - ãƒã‚°å ±å‘Š
- `enhancement` - æ–°æ©Ÿèƒ½ãƒ»æ©Ÿèƒ½æ‹¡å¼µ
- `documentation` - ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆé–¢é€£
- `good first issue` - åˆå¿ƒè€…å‘ã‘
- `help wanted` - æ”¯æ´å‹Ÿé›†
- `question` - è³ªå•
- `duplicate` - é‡è¤‡
- `invalid` - ç„¡åŠ¹
- `wontfix` - å¯¾å¿œã—ãªã„

#### ã‚«ã‚¹ã‚¿ãƒ ãƒ©ãƒ™ãƒ«

**æ©Ÿèƒ½ç³»ãƒ©ãƒ™ãƒ«**

- `type: core` - ã‚³ã‚¢æ©Ÿèƒ½ãƒ»åŸºç›¤é–¢é€£ï¼ˆResultå‹ã€ã‚¨ãƒ©ãƒ¼å‡¦ç†ç­‰ï¼‰
- `type: cli` - CLIæ©Ÿèƒ½é–¢é€£

**APIç³»ãƒ©ãƒ™ãƒ«**

- `type: api-sru` - SRU APIé–¢é€£
- `type: api-opensearch` - OpenSearch APIé–¢é€£
- `type: api-openurl` - OpenURL APIé–¢é€£
- `type: api-oai-pmh` - OAI-PMH APIé–¢é€£
- `type: api-thumbnail` - Thumbnail APIé–¢é€£

**å„ªå…ˆåº¦ãƒ©ãƒ™ãƒ«**

- `priority: high` - å„ªå…ˆåº¦é«˜ï¼ˆåŸºç›¤æ©Ÿèƒ½ã€ä¸»è¦APIï¼‰
- `priority: medium` - å„ªå…ˆåº¦ä¸­ï¼ˆCLIã€è£œåŠ©æ©Ÿèƒ½ï¼‰
- `priority: low` - å„ªå…ˆåº¦ä½ï¼ˆãã®ä»–APIã€æ‹¡å¼µæ©Ÿèƒ½ï¼‰

#### ãƒ©ãƒ™ãƒ«ä½¿ç”¨ä¾‹

```bash
# åŸºç›¤æ©Ÿèƒ½ã®Issueä½œæˆ
gh issue create --label "type: core,priority: high,enhancement"

# SRU APIå®Ÿè£…ã®Issueä½œæˆ
gh issue create --label "type: api-sru,priority: high,enhancement"

# ãƒã‚°å ±å‘Š
gh issue create --label "bug,type: api-sru"
```

## é–‹ç™ºç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

```bash
# ãƒªãƒã‚¸ãƒˆãƒªã‚¯ãƒ­ãƒ¼ãƒ³
git clone https://github.com/masinc/deno-ndl.git
cd deno-ndl

# ä¾å­˜é–¢ä¿‚ã®ç¢ºèª
deno cache --reload mod.ts

# æ–°ã—ã„Issueã‹ã‚‰ä½œæ¥­é–‹å§‹
gh issue create
gh issue develop #{issueç•ªå·} --checkout
```

### å¿…è¦ãªç’°å¢ƒ

- Deno 2.0+
- Git
- GitHub CLI
- VS Code + Denoæ‹¡å¼µæ©Ÿèƒ½

## ãƒ“ãƒ«ãƒ‰ãƒ»ãƒ†ã‚¹ãƒˆ

```bash
# å…¨ãƒã‚§ãƒƒã‚¯å®Ÿè¡Œï¼ˆtype check + lint + format check + testï¼‰
deno task check

# å€‹åˆ¥å®Ÿè¡Œ
deno check **/*.ts                           # å‹ãƒã‚§ãƒƒã‚¯
deno task lint                               # ãƒªãƒ³ãƒˆ
deno fmt --check                             # ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãƒã‚§ãƒƒã‚¯
deno fmt                                     # ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆä¿®æ­£
deno task test                               # ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
deno task test:integration                   # çµ±åˆãƒ†ã‚¹ãƒˆå®Ÿè¡Œï¼ˆè¦ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ï¼‰
```

### ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã«ã¤ã„ã¦

- **ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ**: `deno task test` - ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä¸è¦ã€ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ä½¿ç”¨
- **çµ±åˆãƒ†ã‚¹ãƒˆ**: `deno task test:integration` - å®Ÿéš›ã®NDL APIã¨ã®é€šä¿¡ãƒ†ã‚¹ãƒˆ

## å‚è€ƒè³‡æ–™

- [NDL Search APIä»•æ§˜æ›¸](https://ndlsearch.ndl.go.jp/help/api/specifications)
- [DC-NDLä»•æ§˜](https://www.ndl.go.jp/jp/dlib/standards/meta/index.html)
- [Zod Documentation](https://zod.dev/)
- [Deno Manual](https://deno.land/manual)
